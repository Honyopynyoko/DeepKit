"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@deepkit/core");
const globals_1 = require("@jest/globals");
const zone_1 = require("../src/zone");
globals_1.test('zone', async () => {
    zone_1.Zone.enable();
    globals_1.expect(zone_1.Zone.current()).toEqual({});
    const promises = [];
    promises.push(zone_1.Zone.run({ sub: 1 }, async () => {
        var _a;
        await core_1.sleep(0.2);
        globals_1.expect((_a = zone_1.Zone.current()) === null || _a === void 0 ? void 0 : _a.sub).toBe(1);
    }));
    promises.push(zone_1.Zone.run({ sub: 3 }, async () => {
        var _a;
        await core_1.sleep(0.2);
        globals_1.expect((_a = zone_1.Zone.current()) === null || _a === void 0 ? void 0 : _a.sub).toBe(3);
    }));
    promises.push(zone_1.Zone.run({ sub: 2 }, async () => {
        var _a;
        await core_1.sleep(0.01);
        globals_1.expect((_a = zone_1.Zone.current()) === null || _a === void 0 ? void 0 : _a.sub).toBe(2);
        await new Promise(async (resolve) => {
            var _a;
            await core_1.sleep(0.01);
            globals_1.expect((_a = zone_1.Zone.current()) === null || _a === void 0 ? void 0 : _a.sub).toBe(2);
            resolve();
        });
    }));
    await Promise.all(promises);
});
//# sourceMappingURL=zone.spec.js.map