"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createDatabase = exports.bench = void 0;
const globals_1 = require("@jest/globals");
const orm_1 = require("@deepkit/orm");
const adapter_1 = require("../src/adapter");
const perf_hooks_1 = require("perf_hooks");
/**
 * Executes given exec() method 3 times and averages the consumed time.
 */
async function bench(times, title, exec) {
    const start = perf_hooks_1.performance.now();
    for (let i = 0; i < times; i++) {
        await exec(i);
    }
    const took = perf_hooks_1.performance.now() - start;
    console.log(times, 'x benchmark', title, took, 'ms', took / times, 'per item');
}
exports.bench = bench;
const databases = [];
async function createDatabase(dbName = 'testing') {
    dbName = dbName.replace(/\s+/g, '-');
    const database = new orm_1.Database(new adapter_1.MongoDatabaseAdapter('mongodb://localhost/' + dbName));
    await database.adapter.client.dropDatabase(dbName);
    databases.push(database);
    return database;
}
exports.createDatabase = createDatabase;
globals_1.afterEach(async () => {
    for (const database of databases) {
        await database.disconnect(true);
    }
    databases.splice(0, databases.length);
});
//# sourceMappingURL=utils.js.map